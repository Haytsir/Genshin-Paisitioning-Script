// ==UserScript==
// @name            Genshin-Paisitioning Script
// @name:ko         원신-파이지셔닝 스크립트
// @namespace       genshin-paisitioning/script
// @version         1.7.0
// @author          Haytsir
// @description     A script to help you position your characters in Genshin Impact using genshin.gamedot.org Interactive Map
// @description:ko  원신 게임닷 지도에서 실제 게임에서의 캐릭터 위치를 실시간으로 보여줍니다.
// @icon            https://genshin.gamedot.org/asset/xapp-icon128.png.pagespeed.ic.zyAE0ntk9a.webp
// @source          https://github.com/Haytsir/Genshin-Paisitioning-Script
// @downloadURL     https://github.com/Haytsir/Genshin-Paisitioning-Script/raw/gh-pages/userscript/genshin-paisitioning-script.user.js
// @updateURL       https://github.com/Haytsir/Genshin-Paisitioning-Script/raw/gh-pages/userscript/genshin-paisitioning-script.user.js
// @match           https://genshin.gamedot.org/?mid=genshinmaps
// @grant           GM_addStyle
// @grant           unsafeWindow
// ==/UserScript==

(e=>{if(typeof GM_addStyle=="function"){GM_addStyle(e);return}const t=document.createElement("style");t.textContent=e,document.head.append(t)})(" .maps-content-filter>div.current-map{animation:filter-btn-glow 2s ease infinite}.maps-menu>svg{width:24px}@keyframes pulse-blue{0%{margin:-2px;height:4px;width:4px;transform:scale(.95);background:#34ace0b3;box-shadow:0 0 #34ace0b3}70%{margin:-20px;height:40px;width:40px;transform:scale(1);background:#34ace000;box-shadow:0 0 16px 64px #34ace000}to{margin:-20px;height:40px;width:40px;transform:scale(.95);background:#34ace000;box-shadow:0 0 #34ace000}}@keyframes filter-btn-glow{0%{box-shadow:0 5px 10px 5px #00000012,0 0 #34ace0,inset 0 0 #34ace0}to{box-shadow:0 5px 10px 5px #00000012,0 0 10px 8px transparent,inset 0 0 5px 4px transparent}} ");

(function () {
	'use strict';

	class t{state;listeners=new Set;storageKey;constructor(t,e){if(this.storageKey=e?.persist?e.storageKey||"gps_persistent_state":void 0,this.storageKey)try{const e=localStorage.getItem(this.storageKey);if(e){const i=JSON.parse(e);this.state=this.sanitizeState(i,t);}else this.state=t;}catch(i){console.error("GPS: 저장된 설정을 불러오는 중 오류가 발생했습니다. 설정을 초기화합니다.",i),this.state=t;}else this.state=t;}getState(){return this.state}setState(t){this.state={...this.state,...t},this.storageKey&&localStorage.setItem(this.storageKey,JSON.stringify(this.state)),this.notify();}subscribe(t){return this.listeners.add(t),()=>{this.listeners.delete(t);}}notify(){this.listeners.forEach((t=>t(this.state)));}sanitizeState(t,e){const i={};for(const s in e)s in t?"object"==typeof e[s]&&null!==e[s]?i[s]=this.sanitizeState(t[s],e[s]):i[s]=typeof t[s]==typeof e[s]?t[s]:e[s]:i[s]=e[s];return i}}const e=new t({config:{app:{auto_app_update:!0,auto_lib_update:!0,capture_interval:250,capture_delay_on_error:1e3,use_bit_blt_capture_mode:!1},script:{marker_indicator:{show_user_indicator:!0,indicator_size:45,indicator_color:"#d3bc8e",indicator_initial_opacity:.35,indicator_duration:7}}}},{persist:!0,storageKey:"gps_persistent_state"}),i=new t({currentUser:{position:{x:0,y:0},isActive:!1,debug:!1},tempSettings:{isPinned:!0}});function s(){const t=navigator.userAgent;return /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}function o(t){return e=>{customElements.define(t,e);}}function n(t){return decodeURIComponent(t.substring(t.indexOf(",")+1))}var a=Object.defineProperty;let c=class extends HTMLElement{menuItemSlot;constructor(){super(),this.menuItemSlot=document.createElement("slot"),this.attachShadow({mode:"open"}).append(this.menuItemSlot);}createLogo(t=c.LOGO_TYPES.image){const e=document.createElement("div");if(e.className="logo-container",t===c.LOGO_TYPES.svg)e.innerHTML=this.getAttribute("logo")||"";else {const t=new Image;t.src=this.getAttribute("logo")||"",t.alt=this.getAttribute("title")||"",e.appendChild(t);}return e}createTextElement(){const t=document.createElement("p");return t.textContent=this.getAttribute("text")||"",t}connectedCallback(){this.initializeAttributes(),this.hasAttribute("logo")&&this.appendChild(this.createLogo(this.getAttribute("logoType"))),this.appendChild(this.createTextElement());}initializeAttributes(){this.className=this.getAttribute("class")||"",this.title=this.getAttribute("title")||"";}disconnectedCallback(){this.cleanup();}cleanup(){for(;this.firstChild;)this.removeChild(this.firstChild);}};((t,e,i)=>{e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;})(c,"LOGO_TYPES"+"",{image:"image",svg:"svg"}),c=((t,e,i,s)=>{for(var o,n=e,c=t.length-1;c>=0;c--)(o=t[c])&&(n=(o(n))||n);return n})([o("gps-action-menu-item")],c);let g=class extends HTMLElement{shadowRoot;actionPin;actionConnect;actionConfig;unsubscribe=null;isActive;constructor(){super(),this.isActive=!1,this.shadowRoot=this.attachShadow({mode:"open"});const t={pin:{className:"maps-menu gps-pin",title:"내 위치로 이동",text:"따라가기",logo:n("data:image/svg+xml,%3csvg%20viewBox='0%200%201024%201024'%3e%3cpath%20d='M176%20478.208l275.328%2091.733333c1.28%200.426667%202.261333%201.408%202.688%202.688l91.733333%20275.328a4.266667%204.266667%200%200%200%207.978667%200.341334l279.381333-651.861334a4.266667%204.266667%200%200%200-5.589333-5.589333L175.658667%20470.186667a4.266667%204.266667%200%200%200%200.341333%207.978666z'%3e%3c/path%3e%3c/svg%3e"),logoType:c.LOGO_TYPES.svg},connect:{className:"maps-menu gps-connect",title:"플러그인 연결",logo:n("data:image/svg+xml,%3csvg%20fill='currentColor'%20height='800px'%20width='800px'%20version='1.1'%20id='Capa_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20490%20490'%20xml:space='preserve'%3e%3cg%3e%3cpath%20d='M245,490c135.31,0,245-109.69,245-245C490,109.69,380.31,0,245,0S0,109.69,0,245C0,380.31,109.69,490,245,490z%20M245,30.625%20c118.206,0,214.375,96.168,214.375,214.375c0,118.206-96.169,214.375-214.375,214.375c-118.207,0-214.375-96.169-214.375-214.375%20C30.625,126.793,126.793,30.625,245,30.625z'/%3e%3cpath%20d='M388.428,371.511L245,72.551l-143.428,298.96L245,279.522L388.428,371.511z%20M175.848,287.49L245,143.352l69.152,144.138%20l-52.618-33.747L245,243.139l-16.534,10.604L175.848,287.49z'/%3e%3c/g%3e%3c/svg%3e"),text:"실시간 연결",logoType:c.LOGO_TYPES.svg},config:{className:"maps-menu gps-config",title:"설정",logo:n("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20width='122.88px'%20height='95.089px'%20viewBox='0%200%20122.88%2095.089'%20enable-background='new%200%200%20122.88%2095.089'%20xml:space='preserve'%3e%3cg%3e%3cpath%20d='M66.605,9.676c-0.791-0.791-1.718-1.181-2.792-1.181c-1.073,0-2.013,0.39-2.791,1.181l-4.255,4.241%20c-1.141-0.738-2.348-1.383-3.61-1.96c-1.261-0.577-2.55-1.072-3.852-1.502V3.931c0-1.1-0.375-2.026-1.141-2.791%20C47.401,0.375,46.475,0,45.374,0h-8.187c-1.047,0-1.958,0.375-2.75,1.14c-0.778,0.765-1.168,1.691-1.168,2.791v5.973%20c-1.368,0.321-2.697,0.724-3.973,1.221c-1.287,0.496-2.508,1.061-3.663,1.691l-4.711-4.644c-0.738-0.778-1.637-1.181-2.724-1.181%20c-1.075,0-2,0.403-2.792,1.181l-5.73,5.745c-0.791,0.791-1.181,1.718-1.181,2.79c0,1.074,0.39,2.014,1.181,2.792l4.242,4.255%20c-0.738,1.14-1.382,2.348-1.959,3.608c-0.578,1.262-1.073,2.552-1.504,3.853H3.933c-1.102,0-2.028,0.375-2.792,1.14%20C0.376,33.121,0,34.047,0,35.148v8.187c0,1.045,0.376,1.959,1.14,2.751c0.764,0.777,1.691,1.167,2.792,1.167h5.971%20c0.322,1.367,0.724,2.696,1.222,3.971c0.498,1.289,1.061,2.537,1.691,3.744l-4.644,4.63c-0.779,0.739-1.181,1.638-1.181,2.726%20c0,1.073,0.402,2,1.181,2.792l5.745,5.811c0.791,0.738,1.717,1.102,2.792,1.102c1.072,0,2.011-0.363,2.791-1.102l4.254-4.321%20c1.14,0.737,2.349,1.381,3.61,1.96c1.262,0.575,2.55,1.073,3.852,1.502v6.523c0,1.1,0.376,2.025,1.14,2.789%20c0.765,0.767,1.692,1.143,2.792,1.143h8.186c1.047,0,1.959-0.376,2.751-1.143c0.777-0.764,1.167-1.689,1.167-2.789v-5.973%20c1.369-0.321,2.697-0.724,3.972-1.222c1.289-0.496,2.538-1.061,3.744-1.691l4.63,4.645c0.739,0.778,1.65,1.181,2.753,1.181%20c1.112,0,2.025-0.402,2.765-1.181l5.811-5.744c0.738-0.793,1.102-1.719,1.102-2.792s-0.363-2.013-1.102-2.791l-4.321-4.255%20c0.738-1.141,1.382-2.348,1.96-3.609c0.575-1.261,1.072-2.551,1.502-3.852h6.523c1.1,0,2.025-0.378,2.789-1.141%20c0.766-0.766,1.142-1.691,1.142-2.792v-8.186c0-1.047-0.376-1.958-1.142-2.752c-0.764-0.778-1.689-1.167-2.789-1.167h-5.973%20c-0.322-1.315-0.725-2.63-1.222-3.931c-0.496-1.316-1.061-2.55-1.691-3.706l4.645-4.709c0.778-0.738,1.181-1.638,1.181-2.724%20c0-1.075-0.402-2-1.181-2.792L66.605,9.676L66.605,9.676z%20M111.918,53.649c-0.506-0.355-1.044-0.479-1.627-0.376%20c-0.583,0.101-1.057,0.401-1.401,0.904l-1.908,2.702c-0.688-0.292-1.402-0.526-2.144-0.721c-0.737-0.194-1.484-0.343-2.231-0.451%20l-0.616-3.538c-0.105-0.596-0.395-1.063-0.884-1.406c-0.486-0.343-1.024-0.459-1.621-0.354l-4.441,0.774%20c-0.566,0.099-1.025,0.39-1.383,0.879c-0.35,0.487-0.475,1.027-0.369,1.625l0.564,3.238c-0.713,0.303-1.395,0.648-2.037,1.038%20c-0.654,0.392-1.263,0.812-1.828,1.264l-2.995-2.073c-0.476-0.352-0.999-0.484-1.59-0.383c-0.583,0.103-1.046,0.407-1.402,0.904%20l-2.564,3.659c-0.354,0.504-0.479,1.044-0.377,1.623c0.102,0.585,0.402,1.057,0.905,1.404l2.703,1.907%20c-0.292,0.687-0.527,1.402-0.721,2.144c-0.195,0.738-0.343,1.484-0.452,2.231l-3.538,0.616c-0.596,0.104-1.063,0.396-1.406,0.884%20c-0.344,0.486-0.458,1.025-0.354,1.621l0.773,4.441c0.099,0.566,0.388,1.026,0.88,1.383c0.487,0.35,1.027,0.474,1.624,0.369%20l3.239-0.564c0.304,0.713,0.648,1.394,1.038,2.039c0.392,0.652,0.815,1.274,1.272,1.869l-2.081,2.952%20c-0.353,0.475-0.485,0.999-0.383,1.59c0.102,0.583,0.406,1.047,0.904,1.402l3.665,2.607c0.499,0.325,1.036,0.436,1.618,0.334%20c0.583-0.101,1.059-0.389,1.41-0.862l1.899-2.746c0.688,0.293,1.403,0.528,2.144,0.721c0.738,0.194,1.484,0.343,2.23,0.45%20l0.618,3.54c0.104,0.597,0.396,1.063,0.883,1.404c0.486,0.344,1.025,0.46,1.621,0.356l4.439-0.775%20c0.569-0.1,1.028-0.389,1.386-0.879c0.349-0.488,0.474-1.025,0.368-1.624l-0.565-3.241c0.713-0.303,1.396-0.646,2.04-1.037%20c0.651-0.393,1.274-0.814,1.87-1.27l2.951,2.081c0.475,0.352,1.008,0.483,1.604,0.378c0.604-0.104,1.061-0.409,1.388-0.901%20l2.609-3.665c0.324-0.5,0.435-1.036,0.332-1.618c-0.101-0.583-0.387-1.059-0.86-1.41l-2.748-1.899%20c0.294-0.688,0.528-1.403,0.722-2.144c0.194-0.738,0.342-1.484,0.452-2.232l3.537-0.616c0.597-0.104,1.063-0.394,1.405-0.883%20c0.344-0.488,0.459-1.024,0.355-1.621l-0.775-4.441c-0.099-0.567-0.389-1.025-0.879-1.384c-0.487-0.351-1.027-0.473-1.624-0.369%20l-3.239,0.565c-0.299-0.684-0.642-1.358-1.035-2.017c-0.395-0.667-0.816-1.283-1.267-1.85l2.074-2.995%20c0.353-0.475,0.484-0.998,0.38-1.59c-0.101-0.583-0.405-1.045-0.904-1.401L111.918,53.649L111.918,53.649z%20M99.16,64.929%20c1.071-0.188,2.118-0.162,3.147,0.075c1.025,0.246,1.953,0.657,2.777,1.231c0.825,0.582,1.523,1.316,2.101,2.198%20c0.573,0.889,0.95,1.865,1.139,2.936c0.187,1.072,0.16,2.119-0.076,3.15c-0.246,1.023-0.655,1.949-1.233,2.776%20c-0.582,0.823-1.314,1.522-2.196,2.1c-0.889,0.573-1.865,0.951-2.937,1.139c-1.07,0.186-2.117,0.159-3.148-0.077%20c-1.025-0.246-1.95-0.655-2.777-1.232c-0.822-0.582-1.522-1.314-2.1-2.196c-0.572-0.889-0.952-1.866-1.138-2.937%20c-0.188-1.07-0.162-2.117,0.075-3.148c0.246-1.025,0.657-1.951,1.231-2.778c0.583-0.821,1.316-1.521,2.198-2.099%20C97.114,65.494,98.09,65.116,99.16,64.929L99.16,64.929z%20M40.262,24.224c2.201,0,4.28,0.417,6.252,1.248%20c1.961,0.846,3.666,1.986,5.115,3.421c1.435,1.449,2.575,3.156,3.421,5.113c0.833,1.973,1.248,4.054,1.248,6.254%20c0,2.201-0.415,4.282-1.248,6.254c-0.846,1.959-1.986,3.666-3.421,5.115c-1.449,1.436-3.154,2.575-5.115,3.421%20c-1.972,0.833-4.051,1.248-6.252,1.248s-4.282-0.415-6.255-1.248c-1.958-0.846-3.664-1.985-5.112-3.421%20c-1.437-1.449-2.577-3.155-3.423-5.115c-0.831-1.972-1.248-4.053-1.248-6.254c0-2.2,0.417-4.281,1.248-6.254%20c0.846-1.958,1.986-3.664,3.423-5.113c1.448-1.435,3.154-2.576,5.112-3.421C35.979,24.641,38.061,24.224,40.262,24.224%20L40.262,24.224z'/%3e%3c/g%3e%3c/svg%3e"),text:"설정",logoType:c.LOGO_TYPES.svg}};this.actionPin=this.createMenuItem(t.pin),this.actionConnect=this.createMenuItem(t.connect),this.actionConfig=this.createMenuItem(t.config);const e=new CSSStyleSheet;e.replaceSync(":host{width:100%;bottom:20px;left:20px;z-index:99999999;margin-bottom:-10px}gps-action-menu svg{width:80%;fill:#aaa}#maps-menu gps-action-menu svg{fill:#373a3c}gps-action-menu .gps-pin.active svg{fill:#ffc107}gps-action-menu-item{position:relative;width:100%;height:38px;text-align:center;padding:13px 0;color:var(--text);cursor:pointer}gps-action-menu-item:last-child{margin-right:0}gps-action-menu-item svg,gps-action-menu-item img,gps-action-menu-item .mask-image{position:relative;display:inline-block;width:24px;height:24px}gps-action-menu-item:not(:defined){display:none}gps-action-menu-item>svg{fill:var(--text)}gps-action-menu-item.active>svg{fill:var(--focus)}gps-action-menu-item.active>.mask-image{background-color:var(--focus)}gps-action-menu-item>.mask-image{background-color:var(--text);mask-repeat:no-repeat;mask-position:center left;mask-size:contain;-webkit-mask-repeat:no-repeat;-webkit-mask-position:center left;-webkit-mask-size:contain}gps-action-menu-item>p{font-size:12px;margin:0}gps-action-menu-item .logo-container{display:inline-block;width:24px;height:24px}gps-action-menu-item .logo-container svg{width:100%;height:100%;fill:var(--text)}gps-action-menu-item .logo-container img{width:100%;height:100%}gps-action-menu-item.active .logo-container svg{fill:var(--focus)}"),this.shadowRoot.adoptedStyleSheets=[e];}createMenuItem(t){const e=new c;return e.setAttribute("class",t.className),e.setAttribute("title",t.title),e.setAttribute("text",t.text),t.logo&&(e.setAttribute("logo",t.logo),e.setAttribute("logoType",t.logoType||c.LOGO_TYPES.image)),t.svg&&(e.innerHTML=t.svg),this.shadowRoot.appendChild(e),e}connectedCallback(){this.classList.add("gps-action"),this.updateVisibility("true"===this.getAttribute("active")),this.unsubscribe=i.subscribe((()=>{const{isActive:t}=i.getState().currentUser;t!==this.isActive&&(console.debug(`isActive changed: ${t}`),this.updateVisibility(t),this.isActive=t);}));}disconnectedCallback(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null);}updateVisibility(t){this.actionConnect.style.display=t?"none":"block",this.actionPin.style.display=t?"block":"none",this.actionConfig.style.display=t?"block":"none";}};g=((t,e,i,s)=>{for(var o,n=e,a=t.length-1;a>=0;a--)(o=t[a])&&(n=(o(n))||n);return n})([o("gps-action-menu")],g);let u=class extends HTMLElement{elements;isShowing=!1;isMinimized=!1;isProgressing=!1;static get observedAttributes(){return ["title","content","closable","show"]}constructor(){super();const t=this.attachShadow({mode:"open"}),e=new CSSStyleSheet;e.replaceSync(":host{--dialog-bg: var(--background);--dialog-text: var(--text);--dialog-border: rgba(0, 0, 0, .1);--dialog-shadow: rgba(0, 0, 0, .1);--dialog-progress: #d3bc8e;--dialog-error: #dc3545;--dialog-warning: #ffc107;--dialog-success: #28a745;--dialog-minimize: #c4b188;--dialog-progress-height: 4px;--dialog-blur: 8px}.gps-dialog{width:320px;position:fixed;right:-100%;opacity:0;bottom:18em;z-index:9999;transition:all .3s cubic-bezier(.4,0,.2,1);filter:blur(var(--dialog-blur));transform:translateY(20px)}.gps-dialog.show{right:1.5rem;opacity:1;filter:blur(0);transform:translateY(0)}.gps-dialog-container{background:var(--dialog-bg);border-radius:20px;box-shadow:0 4px 6px -1px var(--dialog-shadow),0 2px 4px -2px var(--dialog-shadow);overflow:visible;border:1px solid rgba(255,255,255,.1);position:relative}.gps-dialog-header{display:flex;align-items:center;justify-content:space-between;padding:5px 20px;background:#ffffff05}.gps-dialog-header .gps-dialog-title-area{flex:1}.gps-dialog-header .gps-dialog-title-area .gps-dialog-title{margin:0;font-size:15px;font-weight:500;color:var(--dialog-text);letter-spacing:-.01em}.gps-dialog-header .gps-dialog-buttons{display:flex;gap:4px;margin-left:16px}.gps-dialog-header .gps-dialog-buttons button{background:none;border:none;padding:8px;cursor:pointer;border-radius:12px;color:var(--dialog-text);opacity:.6;transition:all .2s ease;width:32px;height:32px;display:flex;align-items:center;justify-content:center}.gps-dialog-header .gps-dialog-buttons button:hover{opacity:1;background:#ffffff0f}.gps-dialog-header .gps-dialog-buttons button span{display:inline-block;line-height:1}.gps-dialog-header .gps-dialog-buttons .gps-dialog-minimize span{font-size:14px;font-weight:500}.gps-dialog-header .gps-dialog-buttons .gps-dialog-close span{font-size:18px}.gps-dialog-content{padding:16px 20px;position:relative;background:var(--dialog-bg)}.gps-dialog-content .gps-dialog-content-text{color:var(--dialog-text);line-height:1.6;font-size:14px;margin:0;opacity:.9}.gps-dialog-progress{position:absolute;left:0;right:0;bottom:0;height:var(--dialog-progress-height);background:#0000001a;overflow:visible;transform:translateY(100%);transition:transform .3s ease;border-bottom-left-radius:2px;border-bottom-right-radius:2px}.gps-dialog-progress.show{transform:translateY(0)}.gps-dialog-progress .gps-dialog-progress-in{position:absolute;left:0;top:0;height:100%;background:var(--dialog-progress);width:0;transition:width .3s ease;box-shadow:0 0 20px var(--dialog-progress),0 0 10px var(--dialog-progress),0 0 5px var(--dialog-progress);border-bottom-left-radius:2px;border-bottom-right-radius:2px}.gps-dialog-progress .progress-percentage{position:absolute;right:-38px;top:50%;transform:translateY(-50%);font-size:10px;color:var(--dialog-text);z-index:1;font-weight:500;background:var(--dialog-bg);padding:2px 6px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.gps-dialog.minimized .gps-dialog-container{width:40px;height:40px;border-radius:20px;background:var(--dialog-minimize);box-shadow:0 4px 12px -1px #0003,0 2px 6px -2px #0000001a}.gps-dialog.minimized .gps-dialog-header{padding:8px;border:none;justify-content:center}.gps-dialog.minimized .gps-dialog-header .gps-dialog-title-area{display:none}.gps-dialog.minimized .gps-dialog-header .gps-dialog-buttons{margin:0}.gps-dialog.minimized .gps-dialog-header .gps-dialog-buttons .gps-dialog-close{display:none}.gps-dialog.minimized .gps-dialog-header .gps-dialog-buttons .gps-dialog-minimize{color:#fff;opacity:1}.gps-dialog.minimized .gps-dialog-header .gps-dialog-buttons .gps-dialog-minimize:hover{background:#ffffff1a}.gps-dialog.minimized .gps-dialog-content,.gps-dialog.minimized .gps-dialog-progress{display:none}.gps-dialog.minimized.new .gps-dialog-container{animation:pulse 1s}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}to{transform:scale(1)}}@keyframes dialog-complete{0%,to{transform:translateY(0)}25%{transform:translateY(-12px)}75%{transform:translateY(8px)}}@keyframes check-mark{0%{opacity:0;transform:translate(-50%,-50%) scale(1.5)}50%{opacity:1;transform:translate(-50%,-50%) scale(.8)}to{opacity:0;transform:translate(-50%,-50%) scale(1)}}@keyframes progress-shine{to{transform:translate(100%)}}@media screen and (max-width: 768px){.gps-dialog{bottom:5em}.gps-dialog.show{right:1rem}}@media screen and (max-height: 500px){.gps-dialog{bottom:3vh}}@media (prefers-color-scheme: dark){.gps-dialog-container{background:#1e1e1e;border-color:#ffffff0d}.gps-dialog-content{background:#1e1e1e}.gps-dialog-buttons button:hover{background:#ffffff1a}.gps-dialog-progress{background:transparent}.gps-dialog-progress .progress-track{background:#ffffff1a}}"),t.adoptedStyleSheets=[e];}connectedCallback(){this.render(),this.setupEventListeners();}disconnectedCallback(){this.removeEventListeners();}attributeChangedCallback(t,e,i){if(e!==i&&this.elements)switch(t){case"title":this.elements.dialogTitle.textContent=i;break;case"content":this.elements.dialogContentText.textContent=i;break;case"show":this.toggleVisibility("true"===i);break;case"closable":this.toggleClass("closable","true"===i);}}render(){const t=document.createElement("template");t.innerHTML='\n            <div class="gps-dialog">\n                <div class="gps-dialog-container">\n                    <div class="gps-dialog-header">\n                        <div class="gps-dialog-title-area">\n                            <h3 class="gps-dialog-title"></h3>\n                        </div>\n                        <div class="gps-dialog-buttons">\n                            <button class="gps-dialog-minimize" title="최소화">\n                                <span>─</span>\n                            </button>\n                            <button class="gps-dialog-close" title="닫기">\n                                <span>×</span>\n                            </button>\n                        </div>\n                    </div>\n                    <div class="gps-dialog-content">\n                        <div class="gps-dialog-content-text"></div>\n                        <div class="gps-dialog-progress">\n                            <div class="gps-dialog-progress-in">\n                                <div class="progress-percentage">0%</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.initializeElements();}initializeElements(){const t=this.shadowRoot.querySelector(".gps-dialog");this.elements={dialog:t,dialogTitle:t.querySelector(".gps-dialog-title"),dialogContentText:t.querySelector(".gps-dialog-content-text"),dialogMinimize:t.querySelector(".gps-dialog-minimize"),dialogClose:t.querySelector(".gps-dialog-close"),dialogContentProgress:t.querySelector(".gps-dialog-progress"),dialogContentProgressIn:t.querySelector(".gps-dialog-progress-in")};}setupEventListeners(){this.elements.dialogMinimize.addEventListener("click",this.minimize.bind(this)),this.elements.dialogClose.addEventListener("click",this.close.bind(this));}removeEventListeners(){this.elements.dialogMinimize.removeEventListener("click",this.minimize.bind(this)),this.elements.dialogClose.removeEventListener("click",this.close.bind(this));}alert(t,e,i=0,s=!1){this.setAttribute("title",t),this.setAttribute("content",e),this.setAttribute("closable",String(s)),this.setAttribute("show","true"),i>0&&setTimeout((()=>this.close(null)),i);}toggleVisibility(t){this.toggleClass("show",t),this.isShowing=t,this.isMinimized&&t&&(this.toggleClass("new",!0),setTimeout((()=>this.toggleClass("new",!1)),10));}close(t){this.setAttribute("show","false");}showProgress(){this.elements.dialogContentProgress.style.display="block",this.elements.dialogContentProgressIn.style.width="0%",this.isProgressing=!0;}changeProgress(t){if(this.isProgressing){this.elements.dialogContentProgressIn.style.width=`${t}%`;const e=this.shadowRoot.querySelector(".progress-percentage");e&&(e.textContent=`${Math.round(t)}%`);}}hideProgress(){this.isProgressing&&(this.elements.dialog.classList.add("complete"),setTimeout((()=>{this.elements.dialog.classList.remove("complete"),this.elements.dialogContentProgress.style.display="none",this.elements.dialogContentProgressIn.style.width="0%",this.isProgressing=!1;}),1e3));}toggleClass(t,e){this.elements?.dialog&&this.elements.dialog.classList.toggle(t,e);}minimize(){this.isMinimized=!this.isMinimized,this.toggleClass("minimized",this.isMinimized);}get showing(){return this.isShowing}get minimized(){return this.isMinimized}get progressing(){return this.isProgressing}};u=((t,e,i,s)=>{for(var o,n=e,a=t.length-1;a>=0;a--)(o=t[a])&&(n=(o(n))||n);return n})([o("gps-dialog")],u);let f=class extends HTMLElement{userMarkerIcon;userViewAngle;userMarker;constructor(){super(),this.style.visibility="hidden";const t=this.attachShadow({mode:"open"});this.userMarkerIcon=document.createElement("div"),this.userMarkerIcon.classList.add("gps-user-position"),this.userViewAngle=document.createElement("div"),this.userViewAngle.classList.add("gps-user-view-angle");const s=document.createElement("div");s.classList.add("gps-user-marker-indicator"),s.innerHTML='\n            <div class="circle"></div>\n            <div class="circle2"></div>\n            <div class="circle3"></div>\n        ',t.appendChild(this.userMarkerIcon),t.appendChild(this.userViewAngle),t.appendChild(s);const o=new CSSStyleSheet;o.replaceSync(':host{display:flex;width:75px;height:75px;left:-37.5px;top:-37.5px;justify-content:center;align-items:center;position:absolute;z-index:99;transition:opacity .2s;opacity:1;transform-origin:center}:host>div{pointer-events:none}:host .gps-user-position{display:block;width:48px;height:48px;margin:-24px;left:50%;top:50%;background:transparent no-repeat center;background-size:contain;background-image:url(data:image/png;base64,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);position:absolute;z-index:3;transform:rotate(var(--dir));transform-origin:center;transition:transform .2s}:host .gps-user-view-angle{content:" ";display:block;position:absolute;background:transparent no-repeat center;background-size:contain;background-image:url(data:image/png;base64,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);width:133px;height:97px;left:50%;top:50%;margin-top:-95px;margin-left:-66px;opacity:.8;z-index:2;transform:rotate(var(--rot));transform-origin:bottom center;transition:transform .2s}:host .gps-user-marker-indicator{--size: 45;--color: #d3bc8e;--initial-opacity: .35;--final-opacity: 0;--initial-size: 0;--final-size: 1;--animation-duration: 7s;--animation-interval: calc(var(--animation-duration) / 3);position:absolute;height:calc(var(--size) * 1vmin);width:calc(var(--size) * 1vmin)}:host .gps-user-marker-indicator>div{animation:growAndFade var(--animation-duration) infinite ease-out;background-color:var(--color);border-radius:50%;height:100%;opacity:0;position:absolute;width:100%}:host .gps-user-marker-indicator .circle1{animation-delay:0s}:host .gps-user-marker-indicator .circle2{animation-delay:var(--animation-interval)}:host .gps-user-marker-indicator .circle3{animation-delay:calc(var(--animation-interval) * 2)}:host(:hover){opacity:.5;z-index:inherit}@keyframes growAndFade{0%{opacity:var(--initial-opacity);transform:scale(var(--initial-size))}to{opacity:var(--final-opacity);transform:scale(var(--final-size))}}'),t.adoptedStyleSheets=[o],i.subscribe((t=>{this.style.visibility=t.currentUser.isActive?"visible":"hidden";})),e.subscribe((t=>{s.style.visibility=t.config.script.marker_indicator.show_user_indicator?"visible":"hidden",s.style.setProperty("--size",t.config.script.marker_indicator.indicator_size.toString()),s.style.setProperty("--color",t.config.script.marker_indicator.indicator_color),s.style.setProperty("--initial-opacity",t.config.script.marker_indicator.indicator_initial_opacity.toString()),s.style.setProperty("--animation-duration",t.config.script.marker_indicator.indicator_duration.toString()+"s");}));}};f=((t,e,i,s)=>{for(var o,n=e,a=t.length-1;a>=0;a--)(o=t[a])&&(n=(o(n))||n);return n})([o("gps-user-marker")],f);class v extends Error{constructor(t,e,i){super(t),this.code=e,this.retryCount=i;}}class w{static _instance;socket=null;socketState=0;eventHandlers;config;isDestroyed=!1;handlers={onSocketConnectPost:t=>{},onTrackEvent:(t,e)=>{},onGetConfig:(t,e)=>{},onAppUpdateProgress:(t,e)=>{},onAppUpdateDone:(t,e)=>{},onLibUpdateProgress:(t,e)=>{},onLibUpdateDone:(t,e)=>{},onLibInit:(t,e)=>{},onSocketClose:t=>{}};constructor(t){this.config={baseUrl:"http://localhost:32332",timeout:8e3,maxRetries:10,retryDelay:3e3,...t},this.eventHandlers={track:this.onTrackEvent.bind(this),config:this.onConfigEvent.bind(this),update:this.onUpdateEvent.bind(this)};}static getInstance(t){return w._instance&&!w._instance.isDestroyed||(w._instance=new w(t)),w._instance}async getSocket(){let t=0;for(;t++<this.config.maxRetries&&!this.isSocketOpen();)try{const t=await this.registerSocket();if(t)return t}catch(e){const i=Math.min(this.config.retryDelay*Math.pow(2,t),3e4);await this.handleConnectionError(e,t,i);}throw new Error("연결 재시도 횟수 초과")}async handleConnectionError(t,e,i){t instanceof Error&&"TimeoutError"===t.name&&console.warn(`Connection timeout (attempt ${e})`),await new Promise((t=>setTimeout(t,i)));}async registerSocket(){const t=i.getState().currentUser.debug,e=await async function(t,e){const{timeout:i}=e||8e3,s=new AbortController,o=setTimeout((()=>s.abort()),i),n=await fetch(t,{...e,signal:s.signal});return clearTimeout(o),n}(`${this.config.baseUrl}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s?2:1}),timeout:this.config.timeout});if(!e.ok)throw new v("소켓 등록 실패",e.status,0);const{url:o}=await e.json();return t&&console.debug(`register socket: ${o}`),this.socket=new WebSocket(o),this.setupSocketEventListeners(),this.socket}setupSocketEventListeners(){this.socket&&(this.removeSocketEventListeners(),this.boundHandlers={open:this.onWsOpen.bind(this),message:this.onWsMessage.bind(this),error:this.onWsError.bind(this),close:this.onWsClose.bind(this)},Object.entries(this.boundHandlers).forEach((([t,e])=>{this.socket?.addEventListener(t,e);})));}destroy(){this.close(),this.isDestroyed=!0;}async connect(){return null!==await this.getSocket()}isConnected(){return this.isSocketOpen()}setHandlers(t){Object.assign(this.handlers,t);}close(){this.socket&&(this.socket.removeEventListener("open",this.onWsOpen),this.socket.removeEventListener("message",this.onWsMessage),this.socket.removeEventListener("error",this.onWsError),this.socket.removeEventListener("close",this.onWsClose),this.socket.close(),this.socket=null);}isSocketOpen(){return 2===this.socketState&&this.socket?.readyState===WebSocket.OPEN}onWsMessage(t){const e=i.getState().currentUser.debug;try{const i=JSON.parse(t.data);if(e&&"track"!==i.event&&(console.debug(`Message: ${i.event}`),console.debug(i.data)),!this.isValidMessage(i))throw console.error(i),new Error("잘못된 메시지 형식");const s=this.eventHandlers[i.event];s&&s.call(this,t,this.preprocessMessageData(i));}catch(s){this.handleMessageError(s);}}preprocessMessageData(t){return "track"===t?.event?{...t.data,err:t.data.err?JSON.parse(t.data.err):null}:t.data}onWsOpen(t){t?.currentTarget instanceof WebSocket&&t.currentTarget.send(JSON.stringify({event:"checkAppUpdate"})),this.handlers.onSocketConnectPost(t);}onWsError(t){console.debug("============= WebSocket Error ============="),console.debug(`error: ${t}`),console.debug("===========================================");}onWsClose(t){console.debug("============= WebSocket Closed ============="),console.debug(`code: ${t.code}`),console.debug(`reason: ${t.reason}`),console.debug("============================================"),this.close();}onConfigEvent(t,e){this.handlers.onGetConfig(t,e),t?.currentTarget instanceof WebSocket&&(this.handlers.onLibInit(t,e),t.currentTarget.send(JSON.stringify({event:"init"})));}onUpdateEvent(t,e){e.done?"app"==e.targetType?(t?.currentTarget instanceof WebSocket&&t.currentTarget.send(JSON.stringify({event:"checkLibUpdate"})),this.handlers.onAppUpdateDone(t,e)):"cvat"==e.targetType&&(t?.currentTarget instanceof WebSocket&&t.currentTarget.send(JSON.stringify({event:"getConfig"})),this.handlers.onLibUpdateDone(t,e)):"app"==e.targetType?this.handlers.onAppUpdateProgress(t,e):"cvat"==e.targetType&&this.handlers.onLibUpdateProgress(t,e);}sendConfig(t){this.socket&&this.socket.send(JSON.stringify({event:"setConfig",data:t}));}isValidMessage(t){return "object"==typeof t&&null!==t&&"event"in t&&"data"in t}handleMessageError(t){console.error("메시지 처리 중 오류 발생:",t),t instanceof Error&&console.error(t.message);}boundHandlers={};removeSocketEventListeners(){this.socket&&(Object.entries(this.boundHandlers).forEach((([t,e])=>{this.socket?.removeEventListener(t,e);})),this.boundHandlers={});}onTrackEvent(t,e){this.handlers.onTrackEvent(t,e);}addEventListener(t,e){this.socket&&this.socket.addEventListener(t,e);}removeEventListener(t,e){this.socket&&this.socket.removeEventListener(t,e);}}class A{communication;constructor(){this.communication=w.getInstance();}async connect(){return this.communication.connect()}isConnected(){return this.communication.isConnected()}sendConfig(t){this.communication.sendConfig(t);}close(){this.communication.close();}addEventListener(t,e){const i=e.bind(this);this.communication.addEventListener(t,i);}removeEventListener(t,e){this.communication.removeEventListener(t,e);}setHandlers(t){this.communication.setHandlers(t);}destroy(){this.close();}}const k={auto_app_update:{label:"앱 자동 업데이트",type:"checkbox",section:"app",path:"app.auto_app_update"},auto_lib_update:{label:"라이브러리 자동 업데이트",type:"checkbox",section:"app",path:"app.auto_lib_update"},capture_interval:{label:"화면 캡쳐 간격",type:"number",section:"app",path:"app.capture_interval"},capture_delay_on_error:{label:"캡쳐 에러 시 대기 시간",type:"number",section:"app",path:"app.capture_delay_on_error"},use_bit_blt_capture_mode:{label:"비트블럭 캡쳐 모드 사용",type:"checkbox",section:"app",path:"app.use_bit_blt_capture_mode"},show_user_indicator:{label:"위치 마커 시인성 표시 활성화",type:"checkbox",section:"indicator",path:"script.marker_indicator.show_user_indicator"},indicator_size:{label:"위치 마커 시인성 표시 크기",type:"range",section:"indicator",path:"script.marker_indicator.indicator_size",min:30,max:100,step:5},indicator_color:{label:"위치 마커 시인성 표시 색상",type:"color",section:"indicator",path:"script.marker_indicator.indicator_color"},indicator_initial_opacity:{label:"위치 마커 시인성 시작 투명도",type:"range",section:"indicator",path:"script.marker_indicator.indicator_initial_opacity",min:0,max:1,step:.05},indicator_duration:{label:"위치 마커 시인성 애니메이션 지속 시간",type:"range",section:"indicator",path:"script.marker_indicator.indicator_duration",min:3,max:10,step:.5}};let M=class extends HTMLElement{elements;tempConfig;constructor(){super();const t=this.attachShadow({mode:"open"}),i=new CSSStyleSheet;i.replaceSync(':host{--modal-bg: var(--background);--modal-text: var(--text);--modal-border: var(--border);--modal-shadow: rgba(0, 0, 0, .2);--modal-overlay: rgba(0, 0, 0, .5);--modal-primary: #D3BC8E;--modal-primary-hover: burlywood;--modal-secondary: #ECE5D8;--modal-input-bg: #eee}@media (prefers-color-scheme: dark){:host{--modal-input-bg: #4A5366}}.gps-config-modal{visibility:hidden;position:fixed;inset:0;z-index:9999}.gps-config-modal.show{display:block;visibility:visible}.gps-config-modal.show .gps-config-backdrop{opacity:1;z-index:999}.gps-config-modal.show .gps-config-content{transform:translate(-50%,-50%);opacity:1;z-index:9999}.gps-config-backdrop{position:fixed;inset:0;background:var(--modal-overlay);opacity:0;transition:opacity .2s ease}.gps-config-content{position:fixed;top:50%;left:50%;transform:translate(-50%,-40%);background:var(--modal-bg);border-radius:12px;width:90%;max-width:500px;max-height:90vh;box-shadow:0 8px 30px var(--modal-shadow);opacity:0;transition:all .3s ease;overflow:hidden}.gps-config-header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid var(--modal-border)}.gps-config-header h2{margin:0;font-size:1.25rem;font-weight:600;color:var(--modal-text)}.gps-config-header .gps-config-close{background:none;border:none;padding:8px;cursor:pointer;border-radius:50%;transition:background-color .2s}.gps-config-header .gps-config-close:hover{background-color:var(--modal-border)}.gps-config-header .gps-config-close svg{width:20px;height:20px;fill:var(--modal-text)}.gps-config-body{padding:24px;overflow-y:auto;max-height:calc(90vh - 140px)}.gps-config-body .config-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.gps-config-body .config-item:last-child{margin-bottom:0}.gps-config-body .config-label{flex:1;font-size:.95rem;color:var(--modal-text)}.gps-config-body .number-input{width:120px;padding:8px 12px;border:1px solid var(--modal-border);background:var(--modal-input-bg);color:var(--modal-text);border-radius:6px;font-size:.9rem;transition:border-color .2s}.gps-config-body .number-input:focus{outline:none;border-color:var(--modal-primary)}.gps-config-body .toggle-switch{position:relative;display:inline-block;width:46px;height:24px}.gps-config-body .toggle-switch input{opacity:0;width:0;height:0}.gps-config-body .toggle-switch input:checked+.toggle-slider{background-color:var(--modal-primary)}.gps-config-body .toggle-switch input:checked+.toggle-slider:before{transform:translate(20px)}.gps-config-body .toggle-switch .toggle-slider{position:absolute;cursor:pointer;inset:0;margin:-2px;background-color:var(--modal-border);border:2px solid var(--modal-secondary);transition:.3s;border-radius:24px}.gps-config-body .toggle-switch .toggle-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:2px;border:1px solid white;background-color:var(--modal-secondary);transition:.3s;border-radius:50%}.gps-config-footer{display:flex;justify-content:space-between;gap:12px;padding:16px 24px;border-top:1px solid var(--modal-border)}.gps-config-footer button{padding:8px 16px;border-radius:6px;font-size:.9rem;cursor:pointer;transition:all .2s;border:none}.gps-config-footer button.gps-config-save{background-color:var(--modal-primary);color:#fff}.gps-config-footer button.gps-config-save:hover{background-color:var(--modal-primary-hover)}.gps-config-footer button.gps-config-cancel{background-color:transparent;border:1px solid var(--modal-border);color:var(--modal-text)}.gps-config-footer button.gps-config-cancel:hover{background-color:var(--modal-border)}@media (max-width: 768px){.gps-config-content{width:95%;margin:20px}.gps-config-body .config-item{flex-direction:column;align-items:flex-start;gap:8px}.gps-config-body .config-item .number-input{width:100%}}.gps-config-tabs{display:flex;padding:0 24px;border-bottom:1px solid var(--modal-border);background:var(--modal-bg)}.gps-config-tabs .tab-button{padding:12px 16px;border:none;background:none;color:var(--modal-text);cursor:pointer;font-size:14px;position:relative;transition:all .2s}.gps-config-tabs .tab-button:after{content:"";position:absolute;bottom:0;left:0;width:100%;height:2px;background:var(--modal-primary);transform:scaleX(0);transition:transform .2s}.gps-config-tabs .tab-button.active{color:var(--modal-primary)}.gps-config-tabs .tab-button.active:after{transform:scaleX(1)}.gps-config-tabs .tab-button:hover{background:var(--modal-button-hover)}.tab-content{display:none}.tab-content.active{display:block}.range-input{width:120px;height:4px;background:var(--modal-border);border-radius:2px;-webkit-appearance:none}.range-input::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--modal-primary);cursor:pointer;border:2px solid var(--modal-bg);box-shadow:0 0 0 1px var(--modal-border)}.color-input{width:40px;height:40px;padding:0;border:none;border-radius:4px;cursor:pointer}.color-input::-webkit-color-swatch-wrapper{padding:0}.color-input::-webkit-color-swatch{border:2px solid var(--modal-border);border-radius:4px}.range-container{position:relative;width:120px;padding-top:20px}.range-container .range-tooltip{position:absolute;top:0;padding:2px 6px;background:var(--modal-bg);border:1px solid var(--modal-border);border-radius:4px;font-size:12px;color:var(--modal-text);opacity:0;transition:opacity .2s;pointer-events:none;white-space:nowrap;transform:translate(-40%)}.range-container .range-tooltip:after{content:"";position:absolute;left:50%;bottom:-5px;transform:translate(-50%);border-width:5px 5px 0;border-style:solid;border-color:var(--modal-bg) transparent transparent}.range-container .range-tooltip:before{content:"";position:absolute;left:50%;bottom:-6px;transform:translate(-50%);border-width:6px 6px 0;border-style:solid;border-color:var(--modal-border) transparent transparent}.range-container:hover .range-tooltip,.range-container .range-input:active+.range-tooltip{opacity:1}.range-input{width:100%}'),t.adoptedStyleSheets=[i],this.tempConfig={...e.getState().config},this.elements={modal:this.createModal(),content:document.createElement("div"),inputs:new Map,tabs:new Map},t.appendChild(this.elements.modal),this.setupEventListeners();}createModal(){const t=document.createElement("div");return t.className="gps-config-modal",t.innerHTML=`\n            <div class="gps-config-backdrop"></div>\n            <div class="gps-config-content">\n                <header class="gps-config-header">\n                    <h2>설정</h2>\n                    <button class="gps-config-close" title="닫기">\n                        <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>\n                    </button>\n                </header>\n                <div class="gps-config-tabs">\n                    <button class="tab-button active" data-tab="general">일반</button>\n                    <button class="tab-button" data-tab="indicator">위치 마커</button>\n                </div>\n                <div class="gps-config-body">\n                    <div class="tab-content active" data-tab="general">\n                        ${this.createGeneralConfigInputs()}\n                    </div>\n                    <div class="tab-content" data-tab="indicator">\n                        ${this.createIndicatorConfigInputs()}\n                    </div>\n                </div>\n                <footer class="gps-config-footer">\n                    <div class="footer-left">\n                        <button class="gps-config-reset">초기화</button>\n                    </div>\n                    <div class="footer-right">\n                        <button class="gps-config-cancel">취소</button>\n                        <button class="gps-config-save">저장</button>\n                    </div>\n                </footer>\n            </div>\n        `,t}createGeneralConfigInputs(){return Object.entries(k).filter((([t,e])=>"app"===e.section)).map((([t,e])=>this.createConfigInput(t,e))).join("")}createIndicatorConfigInputs(){return Object.entries(k).filter((([t,e])=>"indicator"===e.section)).map((([t,e])=>this.createConfigInput(t,e))).join("")}createConfigInput(t,e){const i=this.getValueFromPath(this.tempConfig,e.path);switch(e.type){case"checkbox":return this.createToggleSwitch(e.label,t,i,e.section);case"range":return `\n                    <div class="config-item">\n                        <label class="config-label">${e.label}</label>\n                        <div class="range-container">\n                            <input type="range" class="range-input" \n                                data-key="${t}" \n                                data-section="${e.section}"\n                                min="${e.min}" \n                                max="${e.max}" \n                                step="${e.step}"\n                                value="${i}">\n                            <div class="range-tooltip">${i}</div>\n                        </div>\n                    </div>\n                `;case"color":return `\n                    <div class="config-item">\n                        <label class="config-label">${e.label}</label>\n                        <input type="color" class="color-input" \n                            data-key="${t}" \n                            data-section="${e.section}"\n                            value="${i}">\n                    </div>\n                `;default:return this.createNumberInput(e.label,t,i,e.section)}}setupEventListeners(){const t=this.elements.modal,e=t.querySelector(".gps-config-backdrop"),i=t.querySelector(".gps-config-close"),s=t.querySelector(".gps-config-cancel"),o=t.querySelector(".gps-config-save"),n=t.querySelector(".gps-config-reset");e?.addEventListener("click",(()=>this.hideModal())),i?.addEventListener("click",(()=>this.hideModal())),s?.addEventListener("click",(()=>this.cancelConfig())),o?.addEventListener("click",(()=>this.saveConfig())),n?.addEventListener("click",(()=>this.resetCurrentSection())),t.querySelectorAll("input").forEach((t=>{const e=t.dataset.key,i=k[e];this.elements.inputs.set(e,t),t.addEventListener("change",(()=>{const e={...this.tempConfig},s=this.getInputValue(t,i.type);this.setValueAtPath(e,i.path,s),this.tempConfig=e;}));})),this.elements.modal.querySelectorAll(".tab-button").forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.dataset.tab;this.switchTab(e);}));})),t.querySelectorAll(".range-input").forEach((t=>{const e=t.nextElementSibling,i=t,s=()=>{const t=i.value,s=Number(i.min)||0,o=(Number(i.max)||100)-s,n=i.offsetWidth-16,a=(Number(t)-s)/o*n+8;e.textContent=t,e.style.left=`${a}px`;};setTimeout(s,0),i.addEventListener("input",s);}));}saveConfig(){e.setState({config:{...this.tempConfig}}),this.hideModal();}cancelConfig(){this.hideModal();}showModal(){this.tempConfig={...e.getState().config},this.elements.inputs.forEach(((t,e)=>{const i=k[e],s=this.getValueFromPath(this.tempConfig,i.path);"checkbox"===t.type?t.checked=s:"color"===t.type?t.value=s:t.value=String(s);})),this.elements.modal.classList.add("show");}hideModal(){this.elements.modal.classList.remove("show"),this.tempConfig={...e.getState().config};}switchTab(t){this.elements.modal.querySelectorAll(".tab-button, .tab-content").forEach((t=>{t.classList.remove("active");})),this.elements.modal.querySelector(`.tab-button[data-tab="${t}"]`)?.classList.add("active"),this.elements.modal.querySelector(`.tab-content[data-tab="${t}"]`)?.classList.add("active");}createToggleSwitch(t,e,i,s){return `\n            <div class="config-item">\n                <label class="config-label">${t}</label>\n                <label class="toggle-switch">\n                    <input type="checkbox" data-key="${e}" ${i?"checked":""}>\n                    <span class="toggle-slider"></span>\n                </label>\n            </div>\n        `}createNumberInput(t,e,i,s){return `\n            <div class="config-item">\n                <label class="config-label">${t}</label>\n                <input type="number" class="number-input" data-key="${e}" value="${i}">\n            </div>\n        `}getInputValue(t,e){switch(e){case"checkbox":return t.checked;case"color":return t.value;default:return Number(t.value)}}resetCurrentSection(){const t=this.elements.modal.querySelector(".tab-button.active"),e="general"===t?.getAttribute("data-tab")?"app":"indicator",i={app:{auto_app_update:!0,auto_lib_update:!0,capture_interval:250,capture_delay_on_error:1e3,use_bit_blt_capture_mode:!1},script:{marker_indicator:{show_user_indicator:!0,indicator_size:45,indicator_color:"#d3bc8e",indicator_initial_opacity:.35,indicator_duration:7}}},s={...this.tempConfig};Object.entries(k).filter((([t,i])=>i.section===e)).forEach((([t,e])=>{const o=this.getValueFromPath(i,e.path);this.setValueAtPath(s,e.path,o);const n=this.elements.inputs.get(t);if(n)if("checkbox"===n.type)n.checked=o;else if("color"===n.type)n.value=o;else if(n.value=String(o),"range"===n.type){const t=n.nextElementSibling;t&&(t.textContent=String(o));}})),this.tempConfig=s;}getValueFromPath(t,e){return e.split(".").reduce(((t,e)=>t?.[e]),t)}setValueAtPath(t,e,i){const s=e.split("."),o=s.pop();s.reduce(((t,e)=>t[e]),t)[o]=i;}};M=((t,e,i,s)=>{for(var o,n=e,a=t.length-1;a>=0;a--)(o=t[a])&&(n=(o(n))||n);return n})([o("gps-config-modal")],M);let C=class extends HTMLElement{messages=new Set;timers=new Map;MAX_MESSAGES=5;AUTO_DISMISS_DELAY=5e3;constructor(){super();const t=this.attachShadow({mode:"open"}),e=new CSSStyleSheet;e.replaceSync('@charset "UTF-8";:host{--toast-bg: var(--background);--toast-text: var(--text);--toast-border: var(--border);--toast-shadow: rgba(0, 0, 0, .15);--toast-error: #dc3545;--toast-warning: #ffc107;--toast-success: #28a745;position:fixed;bottom:15.5rem;right:1.5rem;z-index:9999;width:320px}.gps-toast-container{display:flex;flex-direction:column-reverse;gap:8px;align-items:flex-end}.toast-item{background:var(--toast-bg);border-radius:12px;box-shadow:0 8px 24px var(--toast-shadow);border:1px solid var(--toast-border);opacity:0;transform:translate(100%);transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;cursor:pointer;width:fit-content;max-width:400px;will-change:width;transform-origin:right;position:relative}.toast-item.show{opacity:1;transform:translate(0)}.toast-item:not(.show){opacity:0;transform:translate(100%)}.toast-item.error{border-left:none;background:linear-gradient(to right,var(--toast-error) 4px,var(--toast-bg) 4px)}.toast-item.warning{border-left:none;background:linear-gradient(to right,var(--toast-warning) 4px,var(--toast-bg) 4px)}.toast-item.success{border-left:none;background:linear-gradient(to right,var(--toast-success) 4px,var(--toast-bg) 4px)}.toast-item.refresh .toast-message{opacity:.5!important}.toast-item.minimized{width:40px;height:40px;max-width:40px;border-radius:20px;margin-left:auto}.toast-item.minimized .toast-header{padding:8px;border-bottom:none;clip-path:inset(0 100% 0 0)}.toast-item.minimized .toast-message,.toast-item.minimized .toast-actions{display:none}.toast-item.minimized.error:before,.toast-item.minimized.warning:before,.toast-item.minimized.success:before{content:"!";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;font-size:16px;opacity:0;animation:fade-in .2s ease forwards;animation-delay:.2s}.toast-item.minimized.error:before{color:var(--toast-error)}.toast-item.minimized.warning:before{color:var(--toast-warning)}.toast-item.minimized.success:before{content:"✓";color:var(--toast-success)}.toast-item:not(.minimized) .toast-message,.toast-item:not(.minimized) .toast-actions{opacity:0;animation:none;display:flex;transition:opacity .2s ease;transition-delay:.3s}.toast-item:not(.minimized).show .toast-message,.toast-item:not(.minimized).show .toast-actions{opacity:1}.toast-item:not(.minimized) .toast-header{clip-path:inset(0 0 0 0);transition:clip-path .3s ease}@keyframes toast-refresh{0%{transform:translate(0)}25%{transform:translate(-3px)}50%{transform:translate(3px)}to{transform:translate(0)}}.toast-header{position:relative;display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--toast-border);transition:all .3s cubic-bezier(.4,0,.2,1);clip-path:inset(0 0 0 0)}.toast-header .toast-message{flex:1;font-size:13px;color:var(--toast-text);line-height:1.5;margin-right:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.toast-header .toast-actions{display:flex;gap:8px;align-items:center;flex-shrink:0}.toast-header .toast-actions button{background:none;border:none;color:var(--toast-text);opacity:.6;cursor:pointer;padding:4px;transition:all .2s ease;display:flex;align-items:center;justify-content:center;border-radius:4px;width:24px;height:24px}.toast-header .toast-actions button:hover{opacity:1;background:#0000000d}.toast-header .toast-actions button.toast-details{font-size:16px}.toast-header .toast-actions button.toast-details .details-icon{display:inline-block;transition:transform .2s ease}.toast-header .toast-actions button.toast-minimize{font-size:14px;font-weight:700}.toast-header .toast-actions button.toast-close{font-size:18px}.toast-details-content{padding:14px 16px;border-top:1px solid var(--toast-border);font-size:12px;color:var(--toast-text);opacity:.85;white-space:pre-wrap;display:none;background:#00000005}.toast-item.expanded .toast-details-content{display:block}.toast-minimize{background:none;border:none;color:var(--toast-text);opacity:.6;cursor:pointer;padding:4px;font-size:14px;font-weight:700;transition:all .2s;display:flex;align-items:center;justify-content:center}.toast-minimize:hover{opacity:1}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes show-content{to{overflow:visible}}@media screen and (max-width: 768px){:host{width:calc(100% - 2rem)}.toast-item{width:100%}}@media screen and (min-width: 1280px){:host{bottom:12.5rem}}@media (prefers-color-scheme: dark){.toast-header .toast-actions button:hover{background:#ffffff1a}.toast-details-content{background:#ffffff05}}'),t.adoptedStyleSheets=[e],this.render();}render(){const t=document.createElement("template");t.innerHTML='\n            <div class="gps-toast-container"></div>\n        ',this.shadowRoot.appendChild(t.content.cloneNode(!0));}show(t,e,i,s){const o=this.generateMessageId(i);if(this.hasMessage(o))return void this.refreshTimer(o);const n={id:o,type:t,title:e,content:i,details:s,timestamp:Date.now(),expanded:!1,minimized:!1};this.addMessage(n),this.renderMessage(n),this.scheduleAutoDismiss(n);}generateMessageId(t){return t.trim().toLowerCase()}hasMessage(t){return Array.from(this.messages).some((e=>e.id===t))}addMessage(t){if(this.messages.size>=this.MAX_MESSAGES){const t=Array.from(this.messages)[0];this.removeMessage(t.id);}this.messages.add(t);}renderMessage(t){const e=this.shadowRoot.querySelector(".gps-toast-container"),i=document.createElement("div");i.className=`toast-item ${t.type} ${t.minimized?"minimized":""}`,i.dataset.id=t.id,i.innerHTML=`\n            <div class="toast-header">\n                <div class="toast-message">${t.content}</div>\n                <div class="toast-actions">\n                    ${t.details?'\n                        <button class="toast-details" title="자세히 보기">\n                            <span class="details-icon">›</span>\n                        </button>\n                    ':""}\n                    <button class="toast-minimize" title="최소화">─</button>\n                    <button class="toast-close" title="닫기">×</button>\n                </div>\n            </div>\n            ${t.details?`\n                <div class="toast-details-content">${t.details}</div>\n            `:""}\n        `;const s=i.querySelector(".toast-close");s?.addEventListener("click",(()=>this.removeMessage(t.id)));const o=i.querySelector(".toast-minimize");o?.addEventListener("click",(()=>{t.minimized=!t.minimized,i.classList.toggle("minimized",t.minimized);}));const n=i.querySelector(".toast-details");n&&n.addEventListener("click",(()=>{t.minimized||(t.expanded=!t.expanded,i.classList.toggle("expanded",t.expanded),n.querySelector(".details-icon").style.transform=t.expanded?"rotate(90deg)":"rotate(0deg)");})),i.addEventListener("click",(()=>{t.minimized&&(t.minimized=!1,i.classList.remove("minimized"));}));i.querySelectorAll("button").forEach((t=>{t.addEventListener("click",(t=>{t.stopPropagation();}));})),e?.appendChild(i),requestAnimationFrame((()=>i.classList.add("show")));}removeMessage(t){const e=this.timers.get(t);e&&(window.clearTimeout(e),this.timers.delete(t));const i=this.shadowRoot.querySelector(`.toast-item[data-id="${t}"]`);if(i){i.classList.remove("show");const e=()=>{i.removeEventListener("transitionend",e),i.remove(),this.messages.delete(Array.from(this.messages).find((e=>e.id===t)));};i.addEventListener("transitionend",e);}}refreshTimer(t){const e=this.timers.get(t);e&&window.clearTimeout(e);const i=window.setTimeout((()=>{this.removeMessage(t);}),this.AUTO_DISMISS_DELAY);this.timers.set(t,i);const s=this.shadowRoot.querySelector(`.toast-item[data-id="${t}"]`);s&&(s.classList.add("refresh"),setTimeout((()=>s.classList.remove("refresh")),200));}scheduleAutoDismiss(t){const e=window.setTimeout((()=>{this.removeMessage(t.id);}),this.AUTO_DISMISS_DELAY);this.timers.set(t.id,e);}};C=((t,e,i,s)=>{for(var o,n=e,a=t.length-1;a>=0;a--)(o=t[a])&&(n=(o(n))||n);return n})([o("gps-toast")],C);class D{static _instance=null;root;dialog;actionMenu;userMarker;config;siteHost;isPinned;currentMap;mapElement=null;isActive=!1;_loadAbortController=new AbortController;_loadAbortSignal=this._loadAbortController.signal;_activeAbortController=new AbortController;_activeAbortSignal=this._activeAbortController.signal;eventListeners=new Map;objectPanelMenu=null;objectTargetFilterBtn=null;communication;configModal;toast;static getInstance(){return this._instance||(this._instance=new D),this._instance}constructor(){this.root=document.createElement("div"),this.root.id="gps-root",this.siteHost=location.host,this.root.classList.add(this.siteHost.replace(/\./g,"-")),this.actionMenu=new g,this.root.appendChild(this.actionMenu),this.dialog=new u,this.root.appendChild(this.dialog),this.userMarker=new f,this.communication=new A,this.configModal=new M,this.root.appendChild(this.configModal),this.toast=new C,this.root.appendChild(this.toast),this.communication.setHandlers({onGetConfig:(t,e)=>this.onGetConfig(t,e),onAppUpdateProgress:(t,e)=>this.onAppUpdateProgress(t,e),onAppUpdateDone:(t,e)=>this.onAppUpdateDone(t,e),onLibUpdateProgress:(t,e)=>this.onLibUpdateProgress(t,e),onLibUpdateDone:(t,e)=>this.onLibUpdateDone(t,e)}),this.communication.addEventListener("close",this.onSocketClose),this.registerEventListener(this.actionMenu.actionConnect,"click",(t=>this.onClickLoadPluginBtn(t,!1)),{signal:this._loadAbortSignal}),this.registerEventListener(this.actionMenu.actionConnect,"contextmenu",(t=>this.onClickLoadPluginBtn(t,!0)),{signal:this._loadAbortSignal}),this.registerEventListener(this.actionMenu.actionPin,"click",this.onClickPinBtn),this.registerEventListener(this.actionMenu.actionPin,"contextmenu",this.onRightClickPinBtn),this.isPinned=!0,this.isPinned&&(this.userMarker.classList.add("active"),this.actionMenu.actionPin.classList.add("active")),this.currentMap=0,this.mapElement=this.getDOMElement("#objectViewer"),this.objectPanelMenu=this.getDOMElement("#mapsMenu"),this.objectTargetFilterBtn=this.getDOMElement('#mapsAreaFilter div[data-value="unset"]'),e.subscribe((t=>{if(!Object.is(this.config,t.config)){const{debug:e}=i.getState().currentUser;e&&console.debug("설정 변경됨",t.config),this.config=t.config,this.communication.sendConfig(this.config);}}));}registerEventListener(t,e,i,s){const o=i.bind(this);this.eventListeners.set(`${t.id}-${e}`,o),t.addEventListener(e,o,s);}destroy(){this.communication.destroy(),this.eventListeners.forEach(((t,e)=>{const[i,s]=e.split("-"),o=document.getElementById(i);o?.removeEventListener(s,t);})),this.eventListeners.clear();}handleError(t){(Array.isArray(t)?t:[t]).forEach((t=>{const e=(t.message),i=t instanceof Error?t.stack:t.details;this.toast.show("error","GPS",e,i);}));}async safeExecute(t,e){try{return await t()}catch(i){return this.handleError(i instanceof Error?i:new Error(e)),null}}onClickLoadPluginBtn(t,e){this._loadAbortController.abort(),t.preventDefault(),t.stopPropagation(),this.loadPlugin(e);}loadPlugin(t){!async function(t=!1){const e=new Array;t&&e.push("debug"),e.push("launch");let i=`genshin-paisitioning://${e.join("/")}`;try{const t=document.createElement("a");t.href=i,t.click();}catch(s){console.error(s);}}(t),i.setState({currentUser:{...i.getState().currentUser,debug:t}}),this.communication.connect().then((t=>{t||(this.toast.show("error","GPS","GPA에 연결할 수 없습니다. 앱이 켜져있는지 확인해주세요."),this.onAppDeactivate());}));}onClickPinBtn(t){t.preventDefault(),t.stopPropagation(),this.togglePin();}onRightClickPinBtn(t){t.preventDefault(),t.stopPropagation();}onStartAppUpdate(t,e){this.dialog.alert("GPS",`GPA ${e.targetVersion} 버전 업데이트 중...`,0,!1),this.dialog.showProgress();}onAppUpdateProgress(t,e){this.dialog.progressing||this.onStartAppUpdate(t,e),this.dialog.changeProgress(e.percent);}onAppUpdateDone(t,e){this.dialog.showing&&this.dialog.progressing&&(this.dialog.close(null,`GPA ${e.targetVersion} 버전 업데이트 중...`),this.dialog.hideProgress()),e.updated&&(this.dialog.alert("GPS","GPA가 업데이트 되었습니다. 다시 시작합니다. 진행되지 않으면, 페이지를 새로고침 해주세요."),this.communication.close(),this.onAppDeactivate(),this.loadPlugin(i.getState().currentUser.debug));}onStartLibUpdate(t,e){this.dialog.alert("GPS",`라이브러리 ${e.targetVersion} 버전 업데이트 중...`,0,!1),this.dialog.showProgress();}onLibUpdateProgress(t,e){console.debug("onLibUpdateProgress"),this.dialog.progressing||this.onStartLibUpdate(t,e),this.dialog.changeProgress(e.percent);}onLibUpdateDone(t,e){console.debug("onLibUpdateDone"),this.dialog.showing&&this.dialog.progressing&&(this.dialog.close(null,`라이브러리 ${e.targetVersion} 버전 업데이트 중...`),this.dialog.hideProgress());}onSocketClose(t){this.onAppDeactivate();}onGetConfig(t,i){this.config=e.getState().config,this.onAppActivate(i);}onAppActivate(t=null){this.isActive=!0,i.setState({currentUser:{...i.getState().currentUser,isActive:!0}}),this.dialog.hideProgress(),document.body.classList.add("gps-activated"),this.actionMenu.classList.add("gps-active"),this.actionMenu.actionConnect.classList.add("gps-active"),this.actionMenu.actionConfig.classList.add("gps-active"),this._loadAbortController.abort(),this._activeAbortController=new AbortController,this._activeAbortSignal=this._activeAbortController.signal,this.actionMenu.actionConfig.addEventListener("click",(t=>this.configModal.showModal()),{signal:this._activeAbortSignal}),this.setPinned(!0);}onAppDeactivate(){this.onAppDeactivate(),this.isActive=!1,i.setState({currentUser:{...i.getState().currentUser,isActive:!1}}),this._loadAbortController=new AbortController,this._loadAbortSignal=this._loadAbortController.signal,this.actionMenu.actionConnect.addEventListener("click",(t=>this.onClickLoadPluginBtn(t,!1)),{signal:this._loadAbortSignal}),this.actionMenu.actionConnect.addEventListener("contextmenu",(t=>this.onClickLoadPluginBtn(t,!0)),{signal:this._loadAbortSignal}),document.body.classList.remove("gps-activated"),this.actionMenu.classList.remove("gps-active"),this.actionMenu.actionConnect.classList.remove("gps-active"),this.actionMenu.actionConfig.classList.remove("gps-active"),this._activeAbortController.abort();}setFocusScroll(t,e){}appendUserMarker(t){t.appendChild(this.userMarker);}setPinned(t){if(this.isPinned=t,this.isPinned){if(this.actionMenu.actionPin.classList.add("active"),this.userMarker){let t,e,i,s,o,n;this.userMarker.classList.add("active"),i="translate",s=this.userMarker.style.transform.indexOf(i)+i.length+1,o=this.userMarker.style.transform.indexOf(")",s),n=this.userMarker.style.transform.substring(s,o),n&&([t,e]=n.split(", "),t=parseInt(t),e=parseInt(e),this.setFocusScroll(t,e));}}else this.actionMenu.actionPin.classList.remove("active"),this.userMarker&&this.userMarker.classList.remove("active");}togglePin(){this.setPinned(!this.isPinned);}drawUserIcon(){const t=document.createElement("div");t.className="gps-user-icon",this.root.appendChild(t);}onTrackEvent(t,e){if(!this.isActive)return;if(null!==t){const{debug:t}=i.getState().currentUser;t&&console.debug("onTrackEvent",e);}const{err:s}=e;if(s?.errorList){const t=function(t,e){return t.map((t=>t[e]))}(s.errorList,"msg").map((t=>new Error(t)));this.handleError(t);}}getDOMElement(t,e=document){return e.querySelector(t)}updateUserMarkerPosition(t,e,i,s){if(!this.userMarker)return;let o,n,a,r,c=this.userMarker.style.transform;o="translate",n=this.userMarker.style.transform.indexOf(o)+9+1,a=this.userMarker.style.transform.indexOf(")",n),r=this.userMarker.style.transform.substring(n,a);let l=[Math.round(t)+"px",Math.round(e)+"px"];this.userMarker.style.transform=c.substring(0,n)+l.join(", ")+c.substring(n+r.length),this.userMarker.style.setProperty("--dir",0-i+"deg"),this.userMarker.style.setProperty("--rot",0-s+"deg");}registerWebSocketEvent(t,e,i){const s=i.bind(this);this.eventListeners.set(`websocket-${e}`,s),t.addEventListener(e,s);}}var L=(()=>"undefined"!=typeof unsafeWindow?unsafeWindow:void 0)();class P extends D{static#t;objectPanelMenu=null;objectTargetFilterBtn=null;mapInfo;mcEnsure;focusPos=[0,0];tmpDragging=-1;tmpMousePos=[0,0];static get instance(){return P.#t||(P.#t=new P),P.#t}constructor(){super(),this.communication.setHandlers({onLibInit:(t,e)=>this.onLibInit(t,e),onTrackEvent:(t,e)=>this.onTrackEvent(t,e)});const t=document.getElementById("mapsMenu");t instanceof HTMLDivElement&&(this.objectPanelMenu=t);const e=document.getElementById("mapsAreaFilter");e instanceof HTMLDivElement&&(this.objectTargetFilterBtn=e.querySelector("div[data-value='unset']")),this.userMarker.style.transform=`translate(${L.MAPS_RelativeX}px, ${L.MAPS_RelativeY}px) scale(${L.MAPS_PointScale})`,L.objectLayerPin instanceof HTMLDivElement&&this.appendUserMarker(L.objectLayerPin),this.mapElement=L.objectViewer,this.mapInfo=new Map([[0,"teyvat"],[1,"enkanomiya"],[2,"underground-mines"]]),this.mcEnsure=0,L.objectViewer instanceof HTMLDivElement&&(L.objectViewer.addEventListener("mousedown",(t=>this.onMouseTouchDown(t))),L.objectViewer.addEventListener("touchstart",(t=>this.onMouseTouchDown(t))),L.objectViewer.addEventListener("mouseup",(t=>this.onMouseTouchUp(t))),L.objectViewer.addEventListener("touchend",(t=>this.onMouseTouchUp(t))),L.objectViewer.addEventListener("mousemove",(t=>this.onMouseTouchMove(t))),L.objectViewer.addEventListener("touchmove",(t=>this.onMouseTouchMove(t)))),function(t){const e=L.drawMapsScale;L.drawMapsScale=function(i){var s=e.apply(this,[i]);let n,a,r,c=t.userMarker.style.transform;n=c.indexOf("scale")+5+1,a=c.indexOf(")",n),r=c.substring(n,a-n);let l=[L.MAPS_PointScale];return t.userMarker.style.transform=c.substring(0,n)+l.join(", ")+c.substring(n+r.length),s};const i=L.changeMapsType;L.changeMapsType=function(e){let s;try{s=i.apply(this,[e]),t.onChangeMap.apply(t,[e]);}catch(o){console.error(o);}return s};}(this);}setFocusScroll(t,e){if(L.objectLayerBase instanceof HTMLDivElement&&L.objectViewer instanceof HTMLDivElement){let a=L.objectLayerBase.getClientRects()[0],r=L.objectViewer.getClientRects()[0];var i=L.MAPS_Size/100*(r.width/(a.width/100)),s=L.MAPS_Size/100*(r.height/(a.height/100)),o=(t-i/2)/100*L.MAPS_Scale,n=(e-s/2)/100*L.MAPS_Scale;L.objectViewer.scrollTo({top:n,left:o,behavior:"smooth"});}}setFocusPoint(t,e){if(L.objectLayerBase instanceof HTMLDivElement&&L.objectViewer instanceof HTMLDivElement){t+=L.MAPS_RelativeX,e+=L.MAPS_RelativeY;var i=L.objectLayerBase.getClientRects()[0],s=L.objectViewer.getClientRects()[0],o=L.MAPS_Size/100*(s.width/(i.width/100)),n=L.MAPS_Size/100*(s.height/(i.height/100)),a=(t-o/2)/100*L.MAPS_Scale,r=(e-n/2)/100*L.MAPS_Scale;L.objectViewer.scrollTo({top:r,left:a,behavior:"smooth"});}}onTrackEvent(t,e){let{m:s,x:o,y:n,r:a,a:r}=e;super.onTrackEvent(null,e);const{debug:c}=i.getState().currentUser;if(c&&console.debug("gamedot:onTrackEvent",e),this.currentMap!==s)if(this.mcEnsure<10)this.mcEnsure=this.mcEnsure+1;else if(this.mcEnsure=0,this.currentMap=s,this.mapInfo.has(this.currentMap)){const t=this.mapInfo.get(this.currentMap);t&&this.onPlayerMovedMap(t);}else this.handleError(new Error("알 수 없는 지도입니다."));else {const t=[o,n];switch(this.currentMap){case 0:default:t[0]=(t[0]-2285)/2,t[1]=(t[1]+5890)/2;break;case 1:t[0]=1.275*t[0]-2247,t[1]=1.275*t[1]-670;break;case 2:t[0]=1.275*t[0]-2060,t[1]=1.275*t[1]-225;}let e=[t[0],t[1]];if(e[0]=t[0]+L.MAPS_RelativeX,e[1]=t[1]+L.MAPS_RelativeY,this.isPinned){let e=Math.pow(this.focusPos[0]-t[0],2)+Math.pow(this.focusPos[1]-t[1],2);e=Math.sqrt(e),e>15&&(this.focusPos[0]=t[0],this.focusPos[1]=t[1],this.setFocusPoint(t[0],t[1]));}let i,s,c,l,d=this.userMarker.style.transform;i="translate",s=this.userMarker.style.transform.indexOf(i)+i.length+1,c=this.userMarker.style.transform.indexOf(")",s),l=this.userMarker.style.transform.substring(s,c);let g=[Math.round(e[0])+"px",Math.round(e[1])+"px"];this.userMarker.style.transform=d.substring(0,s)+g.join(", ")+d.substring(s+l.length),this.userMarker.style.setProperty("--dir",0-r+"deg"),this.userMarker.style.setProperty("--rot",0-a+"deg");}}onPlayerMovedMap(t){const e=document.getElementById("mapsAreaFilter");this.objectTargetFilterBtn instanceof HTMLDivElement&&this.objectTargetFilterBtn.classList.remove("current-map"),e instanceof HTMLDivElement&&(this.objectTargetFilterBtn=e.querySelector(`div[data-value='${t}']`)),this.objectTargetFilterBtn instanceof HTMLDivElement&&this.objectTargetFilterBtn.classList.add("current-map"),this.isActive&&this.userMarker&&(L.MAPS_Type!==t?(this.userMarker.classList.add("hide"),this.setPinned(!1),this.dialog.alert("GPS","플레이어의 현재 위치와 활성화된 지도가 다릅니다.",0,!0)):(this.userMarker.classList.remove("hide"),this.dialog.close(null,"플레이어의 현재 위치와 활성화된 지도가 다릅니다.")));}onChangeMap(t,e=""){if(this.isActive&&this.userMarker){L.MAPS_Type!==t?(this.userMarker.classList.add("hide"),this.setPinned(!1),this.dialog.alert("GPS","플레이어의 현재 위치와 활성화된 지도가 다릅니다.",0,!0)):(this.userMarker.classList.remove("hide"),this.dialog.close(null,"플레이어의 현재 위치와 활성화된 지도가 다릅니다.")),this.objectTargetFilterBtn instanceof HTMLDivElement&&this.objectTargetFilterBtn.classList.remove("current-map");const e=document.getElementById("mapsAreaFilter");e instanceof HTMLDivElement&&(this.objectTargetFilterBtn=e.querySelector(`div[data-value='${this.mapInfo.get(this.currentMap)}']`)),this.objectTargetFilterBtn&&this.objectTargetFilterBtn.classList.add("current-map");}}setPinned(t){super.setPinned(t),this.isPinned&&this.mapInfo.get(this.currentMap)!==L.MAPS_Type&&L.changeMapsType(this.mapInfo.get(this.currentMap));}onMouseTouchDown(t){i.getState().currentUser.isActive&&(this.tmpDragging=Date.now(),t instanceof MouseEvent?this.tmpMousePos=[t.clientX,t.clientY]:t instanceof TouchEvent&&(this.tmpMousePos=[t.touches[0].clientX,t.touches[0].clientY]));}onMouseTouchMove(t){if(i.getState().currentUser.isActive&&this.tmpDragging>0&&Date.now()-this.tmpDragging>100){let e=[0,0];t instanceof MouseEvent?e=[t.clientX,t.clientY]:t instanceof TouchEvent&&(e=[t.touches[0].clientX,t.touches[0].clientY]);const i=[Math.abs(e[0]-this.tmpMousePos[0]),Math.abs(e[1]-this.tmpMousePos[1])];(i[0]>20||i[1]>20)&&this.setPinned(!1);}}onMouseTouchUp(t){i.getState().currentUser.isActive&&(this.tmpDragging=0);}onLibInit(t,e){}}(()=>{const t=P.instance;t.objectPanelMenu instanceof HTMLDivElement&&t.objectPanelMenu.appendChild(t.root);})();

})();